
rule MALWARE_AsyncRat_AMSI_Bypass {
	meta:
		author = "https://github.com/EvgenBlohm/Detection"
		date = "07.09.2022"
		description = "Detects an attempt to bypass AMSI as used by e.g ASyncRat"
		reference = "https://bazaar.abuse.ch/sample/ab569cdec0d2c09c770dc1da21bc62efdc0f54baecfa38277d5e065c8556981b/"

	strings:
		$pe_header = {4d 5a}
		
		$amsi_buffer = "QW1zaVNjYW5CdWZmZXI=" ascii wide // AmsiScanBuffer
		$amsi_dll = "YW1zaS5kbGw=" ascii wide //amsi.dll

	condition:
		$pe_header at 0 and $amsi_dll and $amsi_buffer
}


rule MALWARE_ASyncRat_Mutex {
	meta:
		author = "https://github.com/EvgenBlohm/Detection"
		date = "07.09.2022"
		description = "Detects a used mutex by ASyncRat"
		reference = "https://bazaar.abuse.ch/sample/ab569cdec0d2c09c770dc1da21bc62efdc0f54baecfa38277d5e065c8556981b/"

	strings:
		$pe_header = {4d 5a}
		
		$mutex = "/xQkZJ0B4PStB9N9i38N0tLajYSp0mSX7Ogs5F8SByXYKCVY/kvNgr2rdy/7/MGKxWMfNT8W7XTbX0/2ZzyfYVM074zkWlCVMAfdnf3t8Hc=" ascii wide

	condition:
		$pe_header at 0 and $mutex
}


rule MALWARE_ASyncRat_AES_key {
	meta:
		author = "https://github.com/EvgenBlohm/Detection"
		date = "07.09.2022"
		description = "Detects a used AES key by ASyncRat"
		reference = "https://bazaar.abuse.ch/sample/ab569cdec0d2c09c770dc1da21bc62efdc0f54baecfa38277d5e065c8556981b/"

	strings:
		$pe_header = {4d 5a}
		
		$key = "cXFPVmdPQllZRmIzU0htcjVwT3hYMHNtTUcySXpkWE8=" ascii wide

	condition:
		$pe_header at 0 and $key
}


rule MALWARE_ASyncRat_Install {
	meta:
		author = "https://github.com/EvgenBlohm/Detection"
		date = "07.09.2022"
		description = "Detects ASyncRat based on characteristics from the install routine"
		reference = "https://bazaar.abuse.ch/sample/ab569cdec0d2c09c770dc1da21bc62efdc0f54baecfa38277d5e065c8556981b/"

	strings:
		$pe_header = {4d 5a}
		
		$schtaks = "L2Mgc2NodGFza3MgL2NyZWF0ZSAvZiAvc2Mgb25sb2dvbiAvcmwgaGlnaGVzdCAvdG4g" ascii wide

	condition:
		$pe_header at 0 and $schtaks
}


rule MALWARE_ASyncRat_AV_detection {
	meta:
		author = "https://github.com/EvgenBlohm/Detection"
		date = "07.09.2022"
		description = "Detects ASyncRat based on it's AV detection"
		reference = "https://bazaar.abuse.ch/sample/ab569cdec0d2c09c770dc1da21bc62efdc0f54baecfa38277d5e065c8556981b/"

	strings:
		$pe_header = {4d 5a}
		
		$wmi_query = "Select * from AntivirusProduct" ascii wide
		$wmi = "\\\\root\\\\SecurityCenter" ascii wide

	condition:
		$pe_header at 0 and ($wmi_query or $wmi)
}